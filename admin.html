<!DOCTYPE html>
<html>
<head>
  <title>Messages</title>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyBty7-Ncgs2ABlIxXWybqhavT5FgnK9CBg",
      authDomain: "p-web-db.firebaseapp.com",
      projectId: "p-web-db",
      storageBucket: "p-web-db.firebasestorage.app",
      messagingSenderId: "762422687989",
      appId: "1:762422687989:web:7b21e0e7a467f634cb6dbc",
      measurementId: "G-4GSGV6NDC6"
    };

    if (!firebase.apps.length) {
      firebase.initializeApp(firebaseConfig);
    }

    const messagesContainer = document.getElementById('messages');
    const db = firebase.firestore();

    db.collection('contacts')
      .orderBy('timestamp', 'desc')
      .onSnapshot((snapshot) => {
        if (snapshot.empty) {
          messagesContainer.textContent = 'No messages yet.';
          return;
        }

        const items = snapshot.docs
          .map((doc) => {
            const data = doc.data();
            const sentAt = data.timestamp && typeof data.timestamp.toDate === 'function'
              ? data.timestamp.toDate()
              : null;

            const formattedDate = sentAt ? sentAt.toLocaleString() : 'Pending timestamp';
            return `â€¢ ${data.name} <${data.email}>\n  ${data.message}\n  Sent: ${formattedDate}`;
          })
          .join('\n\n');

        messagesContainer.textContent = items;
      }, (error) => {
        console.error('Failed to load messages:', error);
        messagesContainer.textContent = `Failed to load messages: ${error.message}`;
      });
  </script>
</head>
<body>
  <pre id="messages">Loading...</pre>
</body>
</html>